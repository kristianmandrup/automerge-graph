# Automerge graph

[automerge](https://github.com/automerge/automerge) for graphs, using [graphlib](https://github.com/dagrejs/graphlib) via [graphlib-json-graph](https://github.com/jsongraph/graphlib-json-graph)

## Graphlib specification

See the [graphlib specification](https://github.com/jsongraph/json-graph-specification#graphs-object) and [JSON graph format](http://jsongraphformat.info/) specs.

## API

```js
import {
  createAutomergeGraph
} from 'automerge-graph'

const autoGraph = createAutomergeGraph({
  immutable: true
})
  .addNode('person:kristian', {
    name: 'kristian',
    age: 42
  })
  .commit('add node: kristian')

  .addNode('person:javier', {
    name: 'javier',
    age: 35
  })
  .commit('add node: javier')

  .addEdge({
    // override auto-generated id
    // id: 'kristian->javier',
    from: 'person:kristian',
    to: 'person:javier',
    directed: true
  })
  .commit('add edge: kristian -> javier')

    // use auto-generated id convention
  const friendsId = edgeId({
      from: 'person:kristian',
      to: 'person:javier'
    })


  autoGraph.updateEdge({
    id: friendsId,
    to: 'person:cindy' // throws error, since no such node exists
  })

  .removeEdge(friendsId)
  .commit('remove edge: kristian -> javier')

  .removeNode('person:javier')
  .commit('remove node: javier')

  .removeNode('person:kristian')
  .commit('remove node: kristian')
```

Each of these actions will result in an `automerge` commit

```js
const autoGraph = createAutomergeGraph({
    immutable: true,
    autoMessage: true
  })
  .addNode('person:kristian', {
    name: 'kristian',
    age: 42
  })
  .addNode('person:javier', {
    name: 'javier',
    age: 35
  })
  .updateNode('person:javier', {
    job: 'web developer'
  })
  .replaceNode('person:javier', {
    name: 'javier',
    age: 36
    // will implicitly delete the job key since not part of the new node
  })

Will commit using the following auto-generated messages

// => `added node: person:kristian`
// => `added node: person:javier`
// => `updated node: person:javier`
```

## Customized messages

In order to customize the messages you currently need to extend the `Committer` with your own custom action commit logic, such as:

```js
  updateEdge(options: any) {
    options = this.normalizeOpts(options)
    const label = this.edgeLabel(options)
    this.autoGeneratedMessage = `updated edge: ${label}`
    return (doc: any) => {
      this.mutator.updateEdge(doc, options)
    }
  }
```

Alternatively you can override the `autoGenerateMessage` method to translate or re-format the message to suit your preference.

```js
  autoGenerateMessage() {
    return this.translate(this.autoGeneratedMessage)
  }
```

You should then subclass and override the `createCommitter(action)` method of `AutoMergeGraph` class to create an instance of your own `Committer` subclass.

```js
  createCommitter(action: any) {
    createMyOwnCommitter(this.doc, action, this.committerOpts)
  }
```

We will likely redesign this to make it easier to customize in a future release. Let us know if this is a high priority.

## Graphlib

See [Graphlib specs](https://github.com/dagrejs/graphlib/wiki)

```js
var Graph = require("graphlib").Graph;

// Create a new directed graph
var g = new Graph();

// Add node "a" to the graph with no label
g.setNode("a");

g.hasNode("a");
// => true

// Add node "b" to the graph with a String label
g.setNode("b", "b's value");

// Get the label for node b
g.node("b");
// => "b's value"

// Add node "c" to the graph with an Object label
g.setNode("c", { k: 123 });

// What nodes are in the graph?
g.nodes();
// => `[ 'a', 'b', 'c' ]`

// Add a directed edge from "a" to "b", but assign no label
g.setEdge("a", "b");

// Add a directed edge from "c" to "d" with an Object label.
// Since "d" did not exist prior to this call it is automatically
// created with an undefined label.
g.setEdge("c", "d", { k: 456 });

// What edges are in the graph?
g.edges();
// => `[ { v: 'a', w: 'b' },
//       { v: 'c', w: 'd' } ]`.

// Which edges leave node "a"?
g.outEdges("a");
// => `[ { v: 'a', w: 'b' } ]`

// Which edges enter and leave node "d"?
g.nodeEdges("d");
// => `[ { v: 'c', w: 'd' } ]`
```

## Author

Kristian Mandrup

## License

MIT
